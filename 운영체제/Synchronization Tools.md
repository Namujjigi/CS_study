# Synchronization Tools



## 배경

- 프로세스가 병행 또는 병렬로 실행될 때 여러 프로세스가 공유하는 데이터 무결성의 문제상황 해결

- 경쟁상황(race condition) : 여러 프로세스가 하나의 데이터에 접근하여 조작할 때 접근이 발생한 순서에 

  ​                                              의존하는 상황

## 임계구역 문제(Critical Section Problem)

- 임계구역 : 공유 자원에 접근하는 코드의 일부분으로 프로세스가 자신의 임계구역에서 수행하는 동안 다른 

  ​                   프로세스들은 그 임계구역에 들어갈 수 없다.

- 임계구역 문제 : 프로세스들이 데이터를 협력적으로 공유하기 위해 프로토콜(약속)을 설계하는 것

- 임계구역 문제 해결방안

  - 상호 배제 : 프로세스가 자신의 임계구역에서 실행되면 다른 프로세스는 이 임계구역에서 실행할 수 없다.

  - 진행: 임계구역에서 실행중인 프로세스가 없을 때, 진입하려는 여러 프로세스 중 하나는 진입이 가능해야

    ​		  한다.

  - 한정된 대기 :  프로세스가 진입 요청을 한 후 다른 프로세스들이 먼저 자신의 임계구역에 진입하는 횟수는 

    ​                        제한되어 있다.

- 교착상태
  - 복수의 프로세스가 불가능한 상태를 무한정 기다리는 상태
  - 복수의 프로세스가 하나의 자원을 요구하지만 들어줄 수 없는 상태
  - 필요충분 조건
    - 상호배제 : 임계구역을 두 개 이상의 프로세스가 동시에 접근할 수 없다
    - 비선점대기 : 프로세스가 소유하고 있는 자원은 다른 프로세스에 의해 선점될 수 없다.
    - 점유와대기 : 프로세스가 할당된 자원을 가진 상태로 다른 자원을 기다리기 때문에 발생
    - 환형대기 : 각 프로세스는 순환적으로 다음 프로세스가 요구하는 자원을 갖는다.
  
- Peterson's Solution

  ![image-20220217173731727](C:\Users\GD\AppData\Roaming\Typora\typora-user-images\image-20220217173731727.png)

  - flag[i] = true : i가 진입 준비가 됐음
  - turn = j; : j의 진입 가능을 보장
  - while : j가 진입 준비를 마치고 j의 턴이면 임계구역이 종료될 때까지 기다린다
  - flag[i] = flase : i의 임계구역이 종료되었다.



- Memory barrier
  - 메모리의 변경사항을 다른 모든 프로세서에 전파하는 명령

- Spin lock
  - 임계구역 진입이 불가능할 때, 진입이 가능할 때까지 루프를 돌면서 재시도하는 방식으로 구현된 락
  - busy waiting이 발생한다
  - 스케줄러의 지원을 받지 않기 때문에 문맥교환이 일어나지 않는다.
  - 문맥 교환이 일어나지 않기 때문에 멀티 프로세서 시스템에서만 사용할 수 있습니다.
- Mutex lock
  - 자원의 대한 접근을 동기화하기 위한 상호배제기술
  - 임계구역에 진입할 때 까지 busy waiting이 일어나지 않고 sleep상태로 들어감.
  - 공유된 자원의 데이터 혹은 임계영역(Critical Section) 등에 **하나의** **Process 혹은 Thread**가 접근하는 것을 막아줌
- 세마포어
  - 음수가 아닌 정수의 값을 가지고 스레드 간 공유되는 변수
  - 임계구역 문제를 해결하고 동기화를 구현하는데 사용된다
  - 자원의 개수를 의미하기도 한다
  - 공유된 자원의 데이터 혹은 임계영역(Critical Section) 등에 **여러** **Process 혹은 Thread**가 접근하는 것을 막아줌(변수를 사용해서)
- busy waiting
  - 원하는 자원을 얻기 위해 계속해서 권한을 확인하는 것

- monitor

  - 프로세스 동기화 도구

  - 공유자원 + 공유자원에 접근하는 함수 + 2개의 Queue로 구성되어있다

    
